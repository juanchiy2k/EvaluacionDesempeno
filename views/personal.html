{% extends 'default_layout.html'%}

{% block menuresponsivo %} 
<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
</button>
{% endblock %}

{% block menu %}
<div class="navbar-collapse collapse">
  <ul class="nav navbar-nav">
    <li><a href="index.php"><i class="glyphicon glyphicon-home"></i>{% set home = textos.home %} {% trans home %}</a></li>
    <li><a href="planificacion.php"><i class="glyphicon glyphicon-signal"></i>{% set planning = textos.planning %} {% trans planning %}</a></li>
    <li><a href="under_construction.php"><i class="glyphicon glyphicon-eye-open"></i>{% set monitoring = textos.monitoring %} {% trans monitoring %}</a></li>
    <li><a href="under_construction.php"><i class="glyphicon glyphicon-thumbs-up"></i>{% set evaluation = textos.evaluation %} {% trans evaluation %}</a></li>
    <li><a href="#" onClick="imprimirInstructivo($('#hdnLanguage').val());return false"><i class="glyphicon glyphicon-question-sign"></i>{% set help = textos.help %} {% trans help %}</a></li>
    {% if perfil == 'EDITORES' %}
    <li class="dropdown">
      <a href="#" data-toggle="dropdown" class="dropdown-toggle"><i class="glyphicon glyphicon-globe"></i>{% set administration = textos.administration %} {% trans administration %} <b class="caret"></b></a>
      <ul class="dropdown-menu" id="menu1">
        <li>
          <a href="personal.php">Personal <i class="icon-arrow-right"></i></a>
        </li>
        <li class="divider"></li>
        <li class="dropdown-submenu">
          <a href="#">{% set reports = textos.reports %} {% trans reports %}</a>
          <ul class="dropdown-menu">
            <li><a href="procesar_imprimir.php">1-{% set obj_report = textos.obj_report %} {% trans obj_report %}</a></li>
          </ul>
        </li>
      </ul>
    </li>
    {% endif %}
  </ul>
  <ul class="nav navbar-nav navbar-right">
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="glyphicon glyphicon-user"></i> {{ userName }} <b class="caret"></b></a>
      <ul class="dropdown-menu" id="opcionesUsuario">
        <li><a href="" data-toggle="modal" data-target="#divChangePass"><i class="glyphicon glyphicon-cog"></i> {% set change_pass = textos.change_pass %} {% trans change_pass %}</a></li>
        <li class="divider"></li>
        <li><a href="logout.php"><i class="glyphicon glyphicon-off"></i> {% set logout = textos.logout %} {% trans logout %}</a></li>
      </ul>
    </li>
  </ul>
</div>
{% endblock%}

{% block barra %}
<div class="barrainferior">
  <div>
   {% set title = textos.title %} {% trans title %}

 </div>
</div>
{% endblock %}


{% block changePassword %}
<div class="modal fade" id="divChangePass" tabindex="-1" role="dialog" aria-labelledby="lblChangePass" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close cerrar" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title" id="lblChangePass">{% set change_pass = textos.change_pass %} {% trans change_pass %}</h4>
			</div>
			<div class="modal-body">
				<form method="post" action="" id="frmChangePass" name="frmChangePass">
					<div class="form-group">
						<input type="password" id="txtNewPass" name="txtNewPass" placeholder="{% set new_pass = textos.new_pass %} {% trans new_pass %}" class="form-control"/>
						<input type="hidden" id="hdnPassRequired" value="{% set pass_req = textos.pass_req %} {% trans pass_req %}" >
						<input type="hidden" id="hdnPassLength" value="{% set pass_length = textos.pass_length %} {% trans pass_length %}" >
						<input type="hidden" id="hdnPassEqual" value="{% set pass_equal = textos.pass_equal %} {% trans pass_equal %}">
					</div>
					<div class="form-group">
						<input type="password" id="txtRepeatPass" name="txtRepeatPass" placeholder="{% set rep_new_pass = textos.rep_new_pass %} {% trans rep_new_pass %}" class="form-control {required:true,rangelength: [10, 10]}">
					</div>
					<div class="form-group">
						<div class="">
							<img alt="" src="images/ajax-loader.gif" id="ajaxLoader" class="hide">
							<div class="alert alert-danger font-small hide" id="divPassError"><strong>{% set pass_diff = textos.pass_diff %} {% trans pass_diff %}</strong></div>
							<div class="alert alert-success font-small hide" id="divPassMod"><strong>{% set pass_mod = textos.pass_mod %} {% trans pass_mod %}</strong></div>
						</div>
					</div>
					<div class="form-group">
						<div class="">
							<button class="btn btn-small btn-danger" type="submit" id="btnPass">{% set change_pass = textos.change_pass %} {% trans change_pass %}</button>
							<button class="btn btn-small btn-default cerrar"data-dismiss="modal" aria-hidden="true" id="btnCancelar">{% set close = textos.close %} {% trans close %}</button>
						</div>
					</div> 
				</form>
			</div>
		</div>
	</div>
</div>
{% endblock %}

{% block contenidos %}
<div class="container">  
	<div class="titulo centrar-texto" style="font-weight:bold;">
		 {% set list_personal = textos.list_personal|upper %} {% trans list_personal %}
	</div>
	<form id="frmListadoPersonal" name="frmListadoPersonal" method="post" action="">
		{% if lenguaje == 'es' %}
			<input type="hidden" id="hdnLanguage" value="{{ lenguaje }}" >
			{% else %}
			<input type="hidden" id="hdnLanguage" value="" >
		{% endif %}
		<button class="btn btn-danger" data-toggle="modal" data-target="#divAltaPersonal">{% set new_employee = textos.new_employee %} {% trans new_employee %}</button>
		<div class="table-responsive">
			<table  id="tbPersonal" class="table table-striped">
				<thead>
				 	<tr>
						<th>{% set surnames = textos.surnames %} {% trans surnames %}</th>
						<th>{% set names = textos.names %} {% trans names %}</th></th>
						<th>{% set position = textos.position %} {% trans position %}</th>
						<th>{% set office = textos.office %} {% trans office %}</th>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
					</tr>
				</thead>
				
			</table>
		</div>
	</form>
	<!------------------------------------------- BAJA DEL PERSONAL---------------------------------------->
	<div class="modal fade" id="divBajaPersonal" tabindex="-1" role="dialog" aria-labelledby="lblBajaPersonal" aria-hidden="true" data-keyboard="false" data-backdrop="static">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close cerrar" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="lblBajaPersonal">{% set del_personal = textos.del_personal %} {% trans del_personal %}</h4>
				</div>
				<div class="modal-body">
					<form method="post" action="" id="frmBajaPersonal" name="frmBajaPersonal">	
						<input type="hidden" id="hdnEnterFechaBaja" value="{% set enter_data_del = textos.enter_data_del %} {% trans enter_data_del %}">
						<div class="row">
							<div class="form-group col-md-6">
								<label for="txtApellidoBaja" class="control-label">{% set surnames = textos.surnames %} {% trans surnames %}</label>
								<input type="text" class="form-control input-sm" id="txtApellidoBaja">
								<input type="hidden" name="hdnCodPersonal">
							</div>
							<div class="form-group col-md-6">
								<label for="txtNombreBaja" class="control-label">{% set names = textos.names %} {% trans names %}</label>
								<input type="text" class="form-control input-sm" id="txtNombreBaja" >
							</div>
						</div>
						<div class="row">
							<div class="form-group col-md-6">
								<label for="txtCargoBaja" class="control-label">{% set position = textos.position %} {% trans position %}</label>
								<input type="text" class="form-control input-sm" id="txtCargoBaja">    
							</div>
							<div class="form-group col-md-6">
								<label for="txtAreaBaja" class="control-label">{% set field = textos.field %} {% trans field %}</label>
								<input type="text" class="form-control input-sm" id="txtAreaBaja" >
							</div>
						</div>
						<div class="row">
							<div class="form-group col-md-6">
								<label for="txtFechaBaja" class="control-label">{% set date_del = textos.date_del %} {% trans date_del %}</label>
								<input type="text" class="form-control input-sm" id="txtFechaBaja" name="txtFechaBaja">    
							</div>
							<div class="form-group col-md-6">
								<label for="sltMotivo" class="control-label size">{% set reason = textos.reason %} {% trans reason %}</label>
								<select class="form-control input-sm" name="sltMotivo">
									<option value="">{% set select_reason = textos.select_reason %} {% trans select_reason %}</option>
								</select>
							</div>
						</div>
						<div class="form-group">
							<div class="">
								<button type="submit" class="btn btn-sm btn-danger" id="btnBaja" data-borrado=0>{% set ok = textos.ok %} {% trans ok %}</button>
								<button class="btn btn-small btn-default cerrar"data-dismiss="modal" aria-hidden="true" id="btnCancelar">{% set close = textos.close %} {% trans close %}</button>
							</div>
						</div> 
					</form>
				</div>
			</div>
		</div>
	</div>
	<!------------------------------------------- FIN DE BAJA DEL PERSONAL---------------------------------------->
	<!------------------------------------------- ALTA Y MODIFICACION DEL PERSONAL---------------------------------------->
	<div class="modal fade" id="divAltaPersonal" tabindex="-1" role="dialog" aria-labelledby="lblAltaPersonal" aria-hidden="true" data-keyboard="false" data-backdrop="static">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close cerrar" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="lblAltaPersonal">{% set add_personal = textos.add_personal %} {% trans add_personal %}</h4>
				</div>
				<div class="modal-body">
					<form id="frmAlta" name="frmAlta">
						<input type="hidden" id="hdnEnterApellido" value="{% set enter_surname = textos.enter_surname %} {% trans enter_surname %}">
						<input type="hidden" id="hdnEnterNombre" value="{% set enter_name = textos.enter_name %} {% trans enter_name %}">
						<input type="hidden" id="hdnEnterCargo" value="{% set enter_position = textos.enter_position %} {% trans enter_position %}">
						<input type="hidden" id="hdnEnterArea" value="{% set enter_area = textos.enter_area %} {% trans enter_area %}">
						<input type="hidden" id="hdnEnterOficina" value="{% set enter_office = textos.enter_office %} {% trans enter_office %}">
						<input type="hidden" id="hdnEnterFechaIngreso" value="{% set enter_date_admission = textos.enter_date_admission %} {% trans enter_date_admission %}">
						<input type="hidden" id="hdnEnterFechaCargo" value="{% set enter_date_position = textos.enter_date_position %} {% trans enter_date_position %}">
						<input type="hidden" id="hdnEnterMotivo" value="{% set enter_reason = textos.enter_reason %} {% trans enter_reason %}">
						<input type="hidden" id="hdnValidEmail" value="{% set email_valid = textos.email_valid %} {% trans email_valid %}">
						<input type="hidden" id="hdnSoloTexto" value="{% set only_text = textos.only_text %} {% trans only_text %}">
						<input type="hidden" id="hdnCorrectChronogram" value="{% set corr_chron = textos.corr_chron %} {% trans corr_chron %}" >
						<input type="hidden" id="hdnChangeMail" value="{% set mess_change_mail = textos.mess_change_mail %} {% trans mess_change_mail %}">
						<input type="hidden" id="hdnSelectArea" value="{% set select_area = textos.select_area %} {% trans select_area %}">
						<input type="hidden" id="hdnSelectRegional" value="{% set select_regional = textos.select_regional %} {% trans select_regional %}">
						<input type="hidden" id="hdnSelectPosition" value="{% set select_position = textos.select_position %} {% trans select_position %}">
						<input type="hidden" id="hdnSelectOffice" value="{% set select_office = textos.select_office %} {% trans select_office %}">
						<div class="row">
							<div class="form-group col-md-4">
								<label for="sltPais" class="control-label size">{% set country = textos.country %} {% trans country %}</label>
								<select class="form-control input-sm" name="sltPais" id="sltPais">
									<option value="">{% set select_country = textos.select_country %} {% trans select_country %}</option>
									<option value="ARG">ARGENTINA</option>
									<option value="BOL">BOLIVIA</option>
									<option value="GLO">GLOBAL</option>
									<option value="NIC">NICARAGUA</option>
									<option value="MEX">MEXICO</option>
									<option value="PER">PERU</option>
								</select>
							</div>
							<div class="form-group col-md-4">
								<label for="txtApellido" class="control-label size">{% set surnames = textos.surnames %} {% trans surnames %}</label>
								<input type="text" class="form-control input-sm" id="txtApellido" name="txtApellido">
								<input type="hidden" name="hdnCodPersonal">
							</div>
							<div class="form-group col-md-4">
								<label for="txtNombre" class="control-label size">{% set names = textos.names %} {% trans names %}</label>
								<input type="text" class="form-control input-sm" id="txtNombre" name="txtNombre" >
							</div>
						</div>
						<div class="row">
							<div class="form-group col-md-4">
								<label for="sltArea" class="control-label size">{% set field = textos.field %} {% trans field %}</label>
								<select class="form-control input-sm" name="sltArea" id="sltArea">
									<option value="">{% set select_area = textos.select_area %} {% trans select_area %}</option>
								</select>
							</div>
							<div class="form-group col-md-4">
								<label for="sltCargo" class="control-label size">{% set position = textos.position %} {% trans position %}</label>
								<select class="form-control input-sm" name="sltCargo" id="sltCargo">
									<option value="">{% set select_position = textos.select_position %} {% trans select_position %}</option>
								</select>
							</div>
							<div class="form-group col-md-4">
								<label for="sltRegional" class="control-label size">Regional</label>
								<select class="form-control input-sm" name="sltRegional" id="sltRegional">
									<option value="">{% set select_regional = textos.select_regional %} {% trans select_regional %}</option>
								</select>
							</div>
						</div>
						<div class="row">
							<div class="form-group col-md-4">
								<label for="sltOficina" class="control-label size">{% set office = textos.office %} {% trans office %}</label>
								<select class="form-control input-sm" name="sltOficina" id="sltOficina">
									<option value="">{% set select_office = textos.select_office %} {% trans select_office %}</option>
								</select>
							</div>
							<div class="form-group col-md-4">
								<label for="txtFechaNacimiento" class="control-label size">{% set date_birth = textos.date_birth %} {% trans date_birth %}</label>
								<input type="text" class="form-control input-sm" id="txtFechaNacimiento" name="txtFechaNacimiento">    
							</div>
							<div class="form-group col-md-4">
								<label for="txtFechaIngreso" class="control-label size">{% set date_admission = textos.date_admission %} {% trans date_admission %}</label>
								<input type="text" class="form-control input-sm" id="txtFechaIngreso" name="txtFechaIngreso">
							</div>
						</div>
						<div class="row">
							<div class="form-group col-md-4">
								<label for="txtFechaCargo" class="control-label size">{% set date_position = textos.date_position %} {% trans date_position %}</label>
								<input type="text" class="form-control input-sm" id="txtFechaCargo" name="txtFechaCargo">
							</div>
							<div class="form-group col-md-4">
								<label for="txtTipoDni" class="control-label size">{% set type_id = textos.type_id %} {% trans type_id %}</label>
								<select class="form-control input-sm" name="sltTipoDni" id="sltTipoDni">
									<option value="CE">CE</option>
									<option value="CI">CI</option>
									<option value="CURP">CURP</option>
									<option value="DNI">DNI</option>
									<option value="OTRO">{% set other = textos.other %} {% trans other %}</option>
								</select>
							</div>
							<div class="form-group col-md-4">
								<label for="txtDni" class="control-label size">{% set id_number = textos.id_number %} {% trans id_number %}</label>
								<input type="text" class="form-control input-sm" id="txtDni" name="txtDni">    
							</div>
						</div>
						<div class="row">
							<div class="form-group col-md-4">
								<label for="txtEmail" class="control-label size">{% set email = textos.email %} {% trans email %}</label>
								<input type="text" class="form-control input-sm" id="txtEmail" name="txtEmail" data-placement="top">
							</div>
							<div class="form-group col-md-4">
								<label for="sltGrupo" class="control-label size">{% set group = textos.group %} {% trans group %}</label>
								<select class="form-control input-sm" name="sltGrupo" id="sltGrupo">
									<option value="US">{% spaceless %}{% set users = textos.users %} {% trans users %}{% endspaceless %}</option>
									<option value="ED">{% spaceless %}{% set editors = textos.editors %} {% trans editors %}{% endspaceless %}</option>
								</select>	
							</div>
							<div id="divMotivo" class="form-group col-md-4 hide">
								<label for="sltMotivo" class="control-label size">{% set reason = textos.reason %} {% trans reason %}</label>
								<select class="form-control input-sm" name="sltMotivo">
									<option value="">{% set select_reason = textos.select_reason %} {% trans select_reason %}</option>
								</select>
							</div>
						</div>
						<div class="row">
							<div class="form-group col-md-4">
								<label for="txtSuperiorInmediatoApellido" class="control-label size">{% set hiera_sup = textos.hiera_sup %} {% trans hiera_sup %}</label>
								<input type="text" class="form-control input-sm" id="txtSuperiorInmediatoApellido" name="txtSuperiorInmediatoApellido">
								<input type="hidden" id="hdnCodSuperior" name="hdnCodSuperior">
							</div>
							<div class="col-md-4">
								<label for="txtSuperiorInmediatoNombre" class="control-label size" style="color: #FFFFFF">{% set hiera_sup = textos.hiera_sup %} {% trans hiera_sup %}</label>
								<input type="text" class="form-control input-sm" id="txtSuperiorInmediatoNombre">
							</div>
						</div>
						<div class="row">
							<div class="form-group col-md-4">
								<label for="txtSuperiorFuncionalApellido" class="control-label size">{% set reports_func = textos.reports_func %} {% trans reports_func %}</label>
								<input type="text" class="form-control input-sm" id="txtSuperiorFuncionalApellido" name="txtSuperiorFuncionalApellido">
								<input type="hidden" id="hdnCodFuncional" name="hdnCodFuncional">
							</div>
							<div class="col-md-4">
								<label for="txtSuperiorFuncionalNombre" class="control-label size" style="color: #FFFFFF">{% set reports_func = textos.reports_func %} {% trans reports_func %}</label>
								<input type="text" class="form-control input-sm" id="txtSuperiorFuncionalNombre">
							</div>
						</div>
						<div class="row">
							<div class="form-group col-md-12">
								 <button type="submit" class="btn btn-danger btn-sm" id="btnGuardar" data-guardado=0>{% set save = textos.save %} {% trans save %}</button> 
								<button type="button" class="btn btn-danger btn-sm hide" id="btnNuevo">{% set new = textos.new %} {% trans new %}</button>
								<button class="btn btn-small btn-default cerrar"data-dismiss="modal" aria-hidden="true" id="btnCancelar">{% set close = textos.close %} {% trans close %}</button>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
	<!-------------------------------------------FIN DEL ALTA Y MODIFICACION DEL PERSONAL---------------------------------------->
	<!-------------------------------------------MENSAJE GENERAL DE ALERTA---------------------------------------->	
	<div class="modal fade" id="divAlert" tabindex="-1" aria-labelledby="hAlert" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="hAlert"></h4>
				</div>
				<div class="modal-body">
					<label for="" id="lblAlert"></label>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-danger" data-dismiss="modal">{% set ok = textos.ok %} {% trans ok %}</button>
				</div>
			</div>
		</div>
	</div> 
	<!-------------------------------------------FIN DE MENSAJE GENERAL DE ALERTA---------------------------------------->
	<!-----------------MOSTRAR INSTRUCTIVO-------------------------->
	<div class="modal fade modalPdf" id="divPdf" tabindex="-1" role="dialog" aria-labelledby="hPdf" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close cerrar" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="hPdf"></h4>
				</div>
				<div class="modal-body">
					<iframe id="ifrPdf" src="" width="540" height="300" style="border: none;"></iframe>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-danger cerrar" data-dismiss="modal">{% set ok = textos.ok %} {% trans ok %}</button>
				</div>
			</div>
		</div>
	</div>
	<!-----------------FIN MOSTRAR INSTRUCTIVO-------------------------->					
</div>
{% endblock %}

{% block piePagina %} 
<footer>
  <hr>
  {{ piePagina|raw }}
</footer>
{% endblock%}

{% block extraCSS %}
	<link rel="stylesheet" href="css/smoothness/jquery-ui-1.10.4.custom.min.css">
	<link rel="stylesheet" href="css/dataTables.css">
	<link rel="stylesheet" href="css/style.css">
{% endblock %}

{% block javascripts %}
<script type="text/javascript" src="js/jquery/jquery-ui-1.10.4.custom.min.js"></script>
<script type="text/javascript" src="js/jquery/dataTables.js"></script>
<script type="text/javascript" src="js/jquery/jquery.ui.datepicker-es.js"></script>
<script type="text/javascript" src="js/jquery-validation-1.11.1/jquery.validate.min.js"></script>
<script type="text/javascript" src="js/jquery-validation-1.11.1/additional-methods.min.js"></script>
<script type="text/javascript" src="js/ajax.js"></script>
<script>

$(function(){
	$('#divChangePass').on('click', '.cerrar', function () {
		$('#txtNewPass').val("");
		$('#txtRepeatPass').val("");
		$('#divPassMod').addClass('hide');
		$('#divPassError').addClass('hide');
	});

	listarPersonal();

	$('#frmListadoPersonal').on('click', 'button', function(elemento){
	        elemento.preventDefault();
	 
	        var ejecutar = $(this).attr('name');
	        if (ejecutar == 'btnEliminar'){
	            buscarPersonal($(this).val(),'eliminacion');
	            cargarMotivos(2);
	        }
	        else if (ejecutar == 'btnEditar'){
	            $('#lblAltaPersonal').text('{% set edit_personal = textos.edit_personal %} {% trans edit_personal %}');
	            buscarPersonal($(this).val(),'modificacion');
	            cargarMotivos(3);
	            
	            $('#txtEmail')
			        .popover({ content: "Al modificar el email también se modificará el usuario de la persona" })
			        .blur(function () {
			        	$('.popover').css('display', 'none');
			            $(this).popover('hide');
			        })
			        .focus(function () {
			        	$('.popover').css('display', 'block');
			        });

	        }
	});

	$('#divAltaPersonal').on('click', '.cerrar', function () {
		$('#lblAltaPersonal').text('{% set add_personal = textos.add_personal %} {% trans add_personal %}');
		$('#sltPais option[value=""]').prop('selected',true);
		$('input[name="hdnCodPersonal"]').val('');
		$('#txtApellido').val('');
		$('#txtApellido').autocomplete({
			disabled: false
		});
		$('#txtNombre').val('');
		$('#sltArea').empty();
		$('#sltArea').append('<option value="">{% set select_area = textos.select_area %} {% trans select_area %}</option>');
		$('#sltCargo').empty();
		$('#sltCargo').append('<option value="">{% set select_position = textos.select_position %} {% trans select_position %}</option>');
		$('#sltRegional').empty();
		$('#sltRegional').append('<option value="">{% set select_regional = textos.select_regional %} {% trans select_regional %}</option>');
		$('#sltOficina').empty();
		$('#sltOficina').append('<option value="">{% set select_office = textos.select_office %} {% trans select_office %}</option>');
		$('#txtFechaNacimiento').val('');
        $('#txtFechaIngreso').val('');
        $('#txtFechaCargo').val('');
        $('#sltTipoDni option[value="CE"]').prop('selected',true);
        $('#txtDni').val('');
        $('#txtEmail').val('');
        $('#txtEmail').popover('destroy');
        $('#divMotivo').addClass('hide');
        $('#txtSuperiorInmediatoApellido').val('');
        $('#txtSuperiorInmediatoNombre').val('');
        $('#txtSuperiorFuncionalApellido').val('');
        $('#txtSuperiorFuncionalNombre').val('');
        $('#sltGrupo option[value="US"]').prop('selected',true);
        $('body').css("overflow-y", "scroll");
        $('.form-group').removeClass('has-error');
        $('.error').css('display','none');
        $('#btnNuevo').addClass('hide');
	    $('#btnGuardar').prop('disabled', false);
	    $('#btnGuardar').attr('data-guardado', 0);
    });

	$('#divBajaPersonal').on('click', '.cerrar', function(){
		$('input[name="hdnCodPersonal"]').val('');
		$('#txtFechaBaja').val('');
		$('.form-group').removeClass('has-error');
        $('.error').css('display','none');

	});

    $('#txtFechaNacimiento').datepicker($.datepicker.regional[$('#hdnLanguage').val()]);
	$('#txtFechaIngreso').datepicker($.datepicker.regional[$('#hdnLanguage').val()]);
	$('#txtFechaCargo').datepicker($.datepicker.regional[$('#hdnLanguage').val()]);
	$('#txtFechaBaja').datepicker($.datepicker.regional[$('#hdnLanguage').val()]);

	$('#sltPais').change(function(){
      	cargarPaises($(this).val());
	});

	$('#sltArea').change(function() {
		cargarAreas($(this).val());
	});

	$('#sltRegional').change(function() {
		cargarRegionales($(this).val());
	});

	function cargarMotivos(mot){
		$.post('procesar_buscar.php', {tarea: 'cargarMotivos', motivo: mot}, function(respuesta){
      		var motivos = $('[name="sltMotivo"]');
      		motivos.empty();
      		motivos.append('<option value="">{% set select_reason = textos.select_reason %} {% trans select_reason %}</option>');

      		$.each(respuesta, function(index, motivo) {
                // agregamos opciones al combo
            	motivos.append('<option value='+motivo.idmotivo+'>' + motivo.motivo + '</option>');
            });
        }, 'json');
	}

	function split( val ) {
		return val.split( /,\s*/ );
	}
	function extractLast( term ) {
		return split( term ).pop();
	}


	$('#txtApellido').autocomplete({
		source: function (request, response){
			$.ajax({
				type: 'POST',
				url: 'procesar_buscar.php',
				dataType: 'json',
				data: {tarea: 'listarPersonalNombre', apellido: request.term, pais: $('#sltPais').val(), empleado: 'subordinado'},
				success: function( data ) {
					response(data);
				}
			})
		},
		search: function() {
		           // custom minLength
		           var term = extractLast( this.value );
		            if ( term.length < 4 ) {
		                return false;
		            }
		         },
		focus: function() {
		 		    // prevent value inserted on focus
		            return false;
		        },
		select: function( event, ui ) {
		     		var valor = ui.item.value;
		     		var label =   ui.item.label;       
		     		$.ajax({
		     			url:'procesar_buscar.php',
		     			type:'POST',
		     			dataType:'json',
		     			data: {tarea: 'buscarPersonal', codpersonal: valor},
		     		}).done(function(respuesta){
		     			$("#txtNombre").val(respuesta.nombres);
		     			$("#txtApellido").val(respuesta.apellidos);
		     			$("#sltTipoDni option").filter(function() {
						    return $(this).text() == respuesta.tipodi; 
						}).prop('selected', true);
		     			$("#txtDni").val(respuesta.di);
		     			$("#txtEmail").val(respuesta.email);
		     			$('#sltArea').empty();
		     			$('#sltArea').append('<option>'+respuesta.area+'</option>');
		     			$('#sltCargo').empty();
		     			$('#sltCargo').append('<option>'+respuesta.cargo+'</option>');
		     			$('#sltRegional').empty();
		     			$('#sltRegional').append('<option>'+respuesta.regional+'</option>');
		     			$('#sltOficina').empty();
		     			$('#sltOficina').append('<option>'+respuesta.oficina+'</option>');
		     			$('#txtFechaNacimiento').val(respuesta.fechanacimiento);
		     			$('#txtFechaIngreso').val(respuesta.fechaingreso);
		     			$('#txtFechaCargo').val(respuesta.fechacargo);
		     			$('#txtSuperiorInmediatoApellido').val(respuesta.apellidossuperior);
		     			$('#txtSuperiorInmediatoNombre').val(respuesta.nombressuperior);
		     			$('#txtSuperiorFuncionalApellido').val(respuesta.apellidosfuncional);
		     			$('#txtSuperiorFuncionalNombre').val(respuesta.nombresfuncional);
		     			$('#sltGrupo option').filter(function() {
						    return $(this).val() == respuesta.grupo; 
						}).prop('selected', true);
		     			$('#btnGuardar').prop('disabled', true);
		     			$('.form-group').removeClass('has-error');
        				$('.error').css('display','none');
		     			$('#lblAlert').text('{% set existing_personal = textos.existing_personal %} {% trans existing_personal %}');
		     			$('#divAlert').modal('show');
		     			$('#btnNuevo').removeClass('hide');

		     		});
		     		return false;
				}
				
	});
	
	$('#txtSuperiorInmediatoApellido').autocomplete({
		source: function (request, response){
			$.ajax({
				type: 'POST',
				url: 'procesar_buscar.php',
				dataType: 'json',
				data: {tarea: 'listarPersonalNombre', apellido: request.term, empleado: 'jefe'},
				success: function( data ) {
					response(data);
				}
			})
		},
		search: function() {
		           // custom minLength
		           var term = extractLast( this.value );
		            if ( term.length < 4 ) {
		                return false;
		            }
		         },
		focus: function() {
		 		    // prevent value inserted on focus
		            return false;
		        },
		select: function( event, ui ) {
		     		var valor = ui.item.value;
		     		var label =   ui.item.label;       
		     		$.ajax({
		     			url:'procesar_buscar.php',
		     			type:'POST',
		     			dataType:'json',
		     			data: {tarea: 'buscarPersonal', codpersonal: valor},
		     		}).done(function(respuesta){
		     			$('#hdnCodSuperior').val(respuesta.codpersonal);
		     			$('#txtSuperiorInmediatoApellido').val(respuesta.apellidos);
		     			$('#txtSuperiorInmediatoNombre').val(respuesta.nombres);
		     		});
		     		return false;
				}
				
	});
	$('#txtSuperiorFuncionalApellido').autocomplete({
		source: function (request, response){
			$.ajax({
				type: 'POST',
				url: 'procesar_buscar.php',
				dataType: 'json',
				data: {tarea: 'listarPersonalNombre', apellido: request.term, empleado: 'jefe'},
				success: function( data ) {
					response(data);
				}
			})
		},
		search: function() {
		           // custom minLength
		           var term = extractLast( this.value );
		            if ( term.length < 4 ) {
		                return false;
		            }
		         },
		focus: function() {
		 		    // prevent value inserted on focus
		            return false;
		        },
		select: function( event, ui ) {
		     		var valor = ui.item.value;
		     		var label =   ui.item.label;       
		     		$.ajax({
		     			url:'procesar_buscar.php',
		     			type:'POST',
		     			dataType:'json',
		     			data: {tarea: 'buscarPersonal', codpersonal: valor},
		     		}).done(function(respuesta){
		     			$('#hdnCodFuncional').val(respuesta.codpersonal);
		     			$('#txtSuperiorFuncionalApellido').val(respuesta.apellidos);
		     			$('#txtSuperiorFuncionalNombre').val(respuesta.nombres);
		     		});
		     		return false;
				}
				
	});

	$('#divAltaPersonal').on('show.bs.modal', function () {
		$('body').css("overflow-y", "hidden");
	});
	$('#divBajaPersonal').on({
		'show.bs.modal': function () {
			$('body').css("overflow-y", "hidden");
		},
		'hide.bs.modal': function () {
			$('body').css("overflow-y", "visible");
		}
	});
	$('#divAlert').on('hidden.bs.modal', function () {
		$('body').css("overflow-y", "hidden");
		if (parseInt($('#btnGuardar').attr('data-guardado'))  === 1 ||
			parseInt($('#btnBaja').attr('data-borrado')) === 1){
			$('#divAltaPersonal').modal('hide');
			$('#divBajaPersonal').modal('hide');
			//setTimeout(function(){listarPersonal();}, 10000);
			listarPersonal();

			//if(!$('#divAltaPersonal').hasClass('in'))
			//	listarPersonal();
			//$(location).attr('href','personal.php');
			//RefreshTable('#tbPersonal', 'procesar_buscar.php');

			//var oTable = $('#tbPersonal').dataTable();
			//oTable.fnReloadAjax();

		}
	});

	/********Validar Formularios***************/
	$.validator.addMethod(
		'esFecha', 
		function(value, element) {
			if ($('#hdnLanguage').val() === 'es')
				return value.match(/^(0[1-9]|[12][0-9]|3[01])([\/-])(0[1-9]|1[012])\2(\d{4})$/);
			else
				return value.match(/^(0[1-9]|1[012])([\/-])(0[1-9]|[12][0-9]|3[01])\2(\d{4})$/);
		
		},
        $('#hdnCorrectChronogram').val()
	);


	$.validator.addMethod("lettersonly", function(value, element) {
		return this.optional(element) || /^[a-z áéíóúñüàè]+$/i.test(value);
	}, $('#hdnSoloTexto').val());

	//Valida el formulario
	$('#frmAlta').validate({
		submitHandler: function(){
			if($('#txtSuperiorInmediatoApellido').val() == ''){
				$('#hdnCodSuperior').val('');
			}
			if($('#txtSuperiorInmediatoApellido').val() == ''){
				$('#hdnCodFuncional').val('');
			}
			var formData = $('#frmAlta').serialize();

			if ($('input[name="hdnCodPersonal"]').val() === ''){
				$.ajax({
					url: 'procesar_registrar.php',
					type: 'POST',
					dataType: 'json',
					data: formData + '&tarea=registrarPersonal',
					success: function(response){
						if(response == 1){
							$('#btnGuardar').attr('data-guardado', 1);
							$('#lblAlert').text('{% set data_success = textos.data_success %} {% trans data_success %}');
							$('#divAlert').modal('show');
						}
					},
					error:function(){
	                  alert('ERROR GENERAL DEL SISTEMA, INTENTE MAS TARDE');
	              	}
				});
			}else{
				$.ajax({
					url: 'procesar_registrar.php',
					type: 'POST',
					dataType: 'json',
					data: formData + '&tarea=editarPersonal',
				})
				.done(function(response){
					if(response.success === true){
						$('#btnGuardar').attr('data-guardado', 1);
						$('#lblAlert').text('{% set data_success = textos.data_success %} {% trans data_success %}');
						$('#divAlert').modal('show');
						$.post('procesar_email.php', {tarea: 'actualizarDatos', datos: response});
					}
				})
				.fail(function(){
					alert('ERROR GENERAL DEL SISTEMA, INTENTE MAS TARDE');
				});
			}
/* PRUEBA
			$.ajax({
				url: '/path/to/file',
				type: 'default GET (Other values: POST)',
				dataType: 'default: Intelligent Guess (Other values: xml, json, script, or html)',
				data: {param1: 'value1'},
			})
			.done(function() {
				console.log("success");
			})
			.fail(function() {
				console.log("error");
			})
			.always(function() {
				console.log("complete");
			});
			
			*/
			return false;
		},
		highlight: function(element) {
            $(element).closest('.form-group').addClass('has-error');
        },
        unhighlight: function(element) {
            $(element).closest('.form-group').removeClass('has-error');
        },
	    errorPlacement: function(error, element) {
	        if(element.parent('.input-group').length) {
	            error.insertAfter(element.parent());
	        } else {
	            error.insertAfter(element);
	        }
	    },
		rules: {
			txtApellido: {
				required: true,
				lettersonly: true
			},
			txtNombre: {
				required: true,
				lettersonly: true
			},
			txtCargo: {
				required: true
			},
			txtArea: {
				required: true
			},
			txtOficina: {
				required: true
			},
			txtFechaIngreso: {
				required: true,
				esFecha: true
			},
			txtFechaCargo: {
				required: true,
				esFecha: true
			},
			txtEmail: {
				email: true
			},
			sltMotivo: {
				required: true
			}
		},
		messages: {
			txtApellido: {
				required: $('#hdnEnterApellido').val()
			},
			txtNombre: {
				required: $('#hdnEnterNombre').val()	
			},
			txtCargo: {
				required: $('#hdnEnterCargo').val()	
			},
			txtArea: {
				required: $('#hdnEnterArea').val()	
			},
			txtOficina: {
				required: $('#hdnEnterOficina').val()	
			},
			txtFechaIngreso: {
				required: $('#hdnEnterFechaIngreso').val()	
			},
			txtFechaCargo: {
				required: $('#hdnEnterFechaCargo').val()	
			},
			txtEmail: {
				email: $('#hdnValidEmail').val()
			},
			sltMotivo: {
				required: $('#hdnEnterMotivo').val()
			}

		}

	});
	
	$('#frmBajaPersonal').validate({
		submitHandler:function(){
			var formData = $('#frmBajaPersonal').serialize();

			$.ajax({
				url: 'procesar_registrar.php',
				type: 'POST',
				dataType: 'json',
				data: formData + '&tarea=registrarBaja',
				success: function(response){
					if (response == 1) {
						$('#btnBaja').attr('data-borrado', 1);
						$('#lblAlert').text('{% set employee_del = textos.employee_del %} {% trans employee_del %}');
						$('#divAlert').modal('show');
					}
				}
			});

			return false;
		},
		highlight: function(element) {
            $(element).closest('.form-group').addClass('has-error');
        },
        unhighlight: function(element) {
            $(element).closest('.form-group').removeClass('has-error');
        },
	    errorPlacement: function(error, element) {
	        if(element.parent('.input-group').length) {
	            error.insertAfter(element.parent());
	        } else {
	            error.insertAfter(element);
	        }
	    },
	    rules: {
	    	txtFechaBaja: {
	    		required: true,
				esFecha: true
	    	},
	    	sltMotivo: {
				required: true
			}
	    },
	    messages: {
			txtFechaBaja: {
				required: $('#hdnEnterFechaBaja').val()
			},
			sltMotivo: {
				required: $('#hdnEnterMotivo').val()
			}
		}
	});

	$('body').on('click', '#frmAlta button', function(elemento){

		var ejecutar = $(this).attr('id');

		if (ejecutar == 'btnNuevo'){
			/*var values = [];
	    	var selected = $("select").each(
		      	function(){
		       		values.push( $(this).val());
	        });
	     	this.form.reset();
	     	for (i=0;i<selected.length;i++)
	      		$(selected[i]).val(values[i]);
		*/		
	      	
	      	
	      	/*$('#txtApellido').val('');
	      	$('#txtNombre').val('');
	      	$('#txtCargo').val('');
	      	$('#txtArea').val('');
	      	$('#txtOficina').val('');*/
	      	$('#sltPais option[value=""]').prop('selected',true);
	      	$('input[name="hdnCodPersonal"]').val('');
	        $('#txtApellido').val('');
	        $('#txtApellido').autocomplete({
	        	disabled: false
	        });
	        $('#txtNombre').val('');
	        $('#sltArea').empty();
	        $('#sltArea').append('<option value="">{% set select_area = textos.select_area %} {% trans select_area %}</option>');
	        $('#sltCargo').empty();
	        $('#sltCargo').append('<option value="">{% set select_position = textos.select_position %} {% trans select_position %}</option>');
	        $('#sltRegional').empty();
	        $('#sltRegional').append('<option value="">{% set select_regional = textos.select_regional %} {% trans select_regional %}</option>');
	        $('#sltOficina').empty();
	        $('#sltOficina').append('<option value="">{% set select_office = textos.select_office %} {% trans select_office %}</option>');
	        $('#txtFechaNacimiento').val('');
	        $('#txtFechaIngreso').val('');
	        $('#txtFechaCargo').val('');
	        $('#sltTipoDni option[value="CE"]').prop('selected',true);
	        $('#txtDni').val('');
	        $('#txtEmail').val('');
	        $('#divMotivo').addClass('hide');
	        $('#txtSuperiorInmediatoApellido').val('');
	        $('#txtSuperiorInmediatoNombre').val('');
	        $('#txtSuperiorFuncionalApellido').val('');
	        $('#txtSuperiorFuncionalNombre').val('');
	        $('#sltGrupo option[value="US"]').prop('selected',true);
	      	
	      	$('#txtApellido').focus();
	      	$('#btnNuevo').addClass('hide');
	      	$('#btnGuardar').prop('disabled', false);
	      	$('#btnGuardar').attr('data-guardado', 0);
	      	$('.form-group').removeClass('has-error');
        	$('.error').css('display','none');
  			var validator = $('#frmAlta').validate();
			validator.resetForm();
  			
		}
	});

	



});
</script>
{% endblock %}